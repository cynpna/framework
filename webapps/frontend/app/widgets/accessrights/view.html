<!--
Copyright (C) 2016 iNuron NV

This file is part of Open vStorage Open Source Edition (OSE),
as available from

      http://www.openvstorage.org and
      http://www.openvstorage.com.

This file is free software; you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License v3 (GNU AGPLv3)
as published by the Free Software Foundation, in version 3 as it comes
in the LICENSE.txt file of the Open vStorage OSE distribution.

Open vStorage is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY of any kind.
-->
<section>
    <p data-i18n="[html]ovs:generic.access_right_resolution" style="padding-top: 20px;"></p>
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th data-i18n="ovs:generic.user_client" style="width: 250px;"></th>
                <th data-i18n="ovs:generic.grant" style="width: 75px;"></th>
                <th data-i18n="ovs:generic.deny"></th>
            </tr>
        </thead>
        <tbody>
            <!-- ko foreach: users() -->
                <tr data-bind="let: { root: $parent }">
                    <td><span data-bind="text: username()"></span></td>
                    <td>
                        <span data-bind="visible: root.editMode()">
                            <a data-bind="click: function() { root.swap('users', guid(), true); }" class="hand" style="color: #333;">
                                <span data-bind="visible: root.userRights()[guid()] === true"
                                      class="fa" data-i18n="[html]ovs:icons.checked" style="cursor: inherit;"></span>
                                <span data-bind="visible: root.userRights()[guid()] === false"
                                      class="fa" data-i18n="[html]ovs:icons.notchecked" style="cursor: inherit;"></span>
                                <span data-bind="visible: root.userRights()[guid()] === undefined"
                                      class="fa" data-i18n="[html]ovs:icons.notchecked" style="color: lightgrey; cursor: inherit;"></span>
                            </a>
                        </span>
                        <span data-bind="visible: !root.editMode()">
                            <span data-bind="visible: root.userRights()[guid()] === true"
                                  class="fa" data-i18n="[html]ovs:icons.check"></span>
                        </span>
                    </td>
                    <td>
                        <span data-bind="visible: root.editMode()">
                            <a data-bind="click: function() { $parent.swap('users', guid(), false); }" class="hand" style="color: #333;">
                                <span data-bind="visible: root.userRights()[guid()] === false"
                                      class="fa" data-i18n="[html]ovs:icons.checked" style="cursor: inherit;"></span>
                                <span data-bind="visible: root.userRights()[guid()] === true"
                                      class="fa" data-i18n="[html]ovs:icons.notchecked" style="cursor: inherit;"></span>
                                <span data-bind="visible: root.userRights()[guid()] === undefined"
                                      class="fa" data-i18n="[html]ovs:icons.checked" style="color: lightgrey; cursor: inherit;"></span>
                            </a>
                        </span>
                        <span data-bind="visible: !root.editMode()">
                            <span data-bind="visible: root.userRights()[guid()] === false"
                                  class="fa" data-i18n="[html]ovs:icons.check"></span>
                            <span data-bind="visible: root.userRights()[guid()] === undefined"
                                  class="fa" data-i18n="[html]ovs:icons.check" style="color: lightgrey;"></span>
                        </span>
                    </td>
                </tr>
                <!-- ko foreach: $parent.userClientMap()[guid()] -->
                    <tr data-bind="let: {
                                       root: $parents[1],
                                       client: $parents[1].clientMap()[$data],
                                       userGuid: $parents[0].guid()
                                   }">
                        <td> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span data-bind="text: client.name()"></span></td>
                        <td>
                            <span data-bind="visible: root.editMode() && root.userRights()[userGuid] !== false">
                                <a data-bind="click: function() { root.swap('clients', client.guid(), true); }" class="hand" style="color: #333;">
                                    <span data-bind="visible: root.clientRights()[$data] === true"
                                          class="fa" data-i18n="[html]ovs:icons.checked" style="cursor: inherit;"></span>
                                    <span data-bind="visible: root.clientRights()[$data] === false"
                                          class="fa" data-i18n="[html]ovs:icons.notchecked" style="cursor: inherit;"></span>
                                    <span data-bind="visible: root.clientRights()[$data] === undefined && root.userRights()[userGuid] !== true"
                                          class="fa" data-i18n="[html]ovs:icons.notchecked" style="color: lightgrey; cursor: inherit;"></span>
                                    <span data-bind="visible: root.clientRights()[$data] === undefined && root.userRights()[userGuid] === true"
                                          class="fa" data-i18n="[html]ovs:icons.checked" style="color: lightgrey; cursor: inherit;"></span>
                                </a>
                            </span>
                            <span data-bind="visible: !root.editMode() || root.userRights()[userGuid] === false">
                                    <span data-bind="visible: root.clientRights()[$data] === true"
                                          class="fa" data-i18n="[html]ovs:icons.check"></span>
                                    <span data-bind="visible: root.clientRights()[$data] === undefined && root.userRights()[userGuid] === true"
                                          class="fa" data-i18n="[html]ovs:icons.check" style="color: lightgrey;"></span>
                            </span>
                        </td>
                        <td>
                            <span data-bind="visible: root.editMode()">
                                <a data-bind="click: function() { root.swap('clients', client.guid(), false); }" class="hand" style="color: #333;">
                                    <span data-bind="visible: root.clientRights()[$data] === false"
                                          class="fa" data-i18n="[html]ovs:icons.checked" style="cursor: inherit;"></span>
                                    <span data-bind="visible: root.clientRights()[$data] === true"
                                          class="fa" data-i18n="[html]ovs:icons.notchecked" style="cursor: inherit;"></span>
                                    <span data-bind="visible: root.clientRights()[$data] === undefined && root.userRights()[userGuid] === true"
                                          class="fa" data-i18n="[html]ovs:icons.notchecked" style="color: lightgrey; cursor: inherit;"></span>
                                    <span data-bind="visible: root.clientRights()[$data] === undefined && root.userRights()[userGuid] !== true"
                                          class="fa" data-i18n="[html]ovs:icons.checked" style="color: lightgrey; cursor: inherit;"></span>
                                </a>
                            </span>
                            <span data-bind="visible: !root.editMode()">
                                    <span data-bind="visible: root.clientRights()[$data] === false"
                                          class="fa" data-i18n="[html]ovs:icons.check"></span>
                                    <span data-bind="visible: root.clientRights()[$data] === undefined && root.userRights()[userGuid] !== true"
                                          class="fa" data-i18n="[html]ovs:icons.check" style="color: lightgrey;"></span>
                            </span>
                        </td>
                    </tr>
                <!-- /ko -->
            <!-- /ko -->
        </tbody>
    </table>
    <button data-bind="visible: editMode(), click: save" class="btn btn-primary">Save</button>
    <button data-bind="visible: !editMode(), click: startEdit,
                       enable: canManage()" class="btn btn-default">Edit</button>
    <button data-bind="visible: editMode(), click: cancelEdit" class="btn btn-default">Cancel</button>
</section>
